{% extends "base.html" %}
{% block title %}Pequehistorias | El cuento donde es protagonista{% endblock %}
{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; background-color: #f9fafb; background-image: radial-gradient(#d1d5db 0.5px, transparent 0.5px); background-size: 15px 15px; }
  .blob { position: absolute; border-radius: 50%; filter: blur(80px); z-index: 0; }
  #cover-image { object-fit: cover; }
</style>

<body class="relative overflow-x-hidden">
  
  <div class="relative bg-indigo-50/80 backdrop-blur-sm overflow-hidden py-12 sm:py-16 md:py-20 lg:py-24">
    <div class="blob w-96 h-96 bg-indigo-200 -top-20 -left-20"></div>
    <div class="blob w-72 h-72 bg-purple-200 -bottom-20 -right-10"></div>
    <div class="container relative mx-auto max-w-6xl px-6 text-center z-10">
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-indigo-900 mb-4 sm:mb-5 leading-tight">Su cara, su nombre, su propia aventura.</h1>
      <p class="text-indigo-800 text-base sm:text-lg md:text-xl max-w-3xl mx-auto mb-6 sm:mb-8">Nuestra IA crea historias e ilustraciones únicas para que tu peque se vea como el verdadero protagonista del cuento.</p>
      <div class="text-center">
        <a href="#crear" class="inline-block bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">¡Crear cuento!</a>
      </div>
    </div>
  </div>

  <div class="py-8 sm:py-12 md:py-16 bg-white/70 backdrop-blur-sm">
    <div class="container mx-auto max-w-5xl px-6">
      <div class="text-center mb-6 sm:mb-8 md:mb-12">
        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">Tu Pequehistoria en 3 simples pasos</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8 md:gap-10 text-center">
        <div class="p-4">
          <div class="flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 mx-auto mb-4">
            <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" /></svg>
          </div>
          <h3 class="font-bold text-lg sm:text-xl text-gray-800 mb-2">1. Personaliza</h3>
          <p class="text-gray-600 text-sm sm:text-base">Dinos su nombre, edad, gustos y sube su foto. La base de toda la magia.</p>
        </div>
        <div class="p-4">
          <div class="flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 mx-auto mb-4">
             <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
          </div>
          <h3 class="font-bold text-lg sm:text-xl text-gray-800 mb-2">2. Creamos la Magia</h3>
          <p class="text-gray-600 text-sm sm:text-base">Nuestra IA da vida a un cuento e ilustraciones que no existen en ningún otro lugar.</p>
        </div>
        <div class="p-4">
          <div class="flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 mx-auto mb-4">
            <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
          </div>
          <h3 class="font-bold text-lg sm:text-xl text-gray-800 mb-2">3. Revisa y Disfruta</h3>
          <p class="text-gray-600 text-sm sm:text-base">Recibe una preview gratis al instante. Si te enamora, lo tienes en formato físico o digital.</p>
        </div>
      </div>
    </div>
  </div>

  <div id="crear" class="py-12 sm:py-16 md:py-20">
    <div class="container mx-auto max-w-6xl px-6">
      <div class="text-center mb-8 sm:mb-12 md:mb-16">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-800 mb-4">Dale vida a su historia</h2>
        <p class="text-gray-600 text-base sm:text-lg max-w-2xl mx-auto">Rellena los 4 pasos y mira cómo su portada cobra vida.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-10 lg:gap-12 lg:items-start">
        <div class="bg-white p-6 sm:p-8 md:p-10 rounded-2xl shadow-xl">
          <form id="bookForm" method="post" action="/api/books/create-preview" enctype="multipart/form-data" class="space-y-4 sm:space-y-6">
            <div>
              <label for="child_name_input" class="block text-gray-700 font-semibold mb-2">Nombre del prota</label>
              <input type="text" id="child_name_input" name="child_name" placeholder="Ej: Leo" required class="w-full border-gray-300 border-2 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
            </div>
            <div>
              <label for="child_age_input" class="block text-gray-700 font-semibold mb-2">Edad</label>
              <input type="number" id="child_age_input" name="child_age" min="1" max="99" placeholder="Ej: 5" required class="w-full border-gray-300 border-2 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
            </div>
            <div>
              <label for="child_desc_input" class="block text-gray-700 font-semibold mb-2">Sus gustos (opcional)</label>
              <textarea id="child_desc_input" name="child_description" placeholder="Le encantan los animales, el color azul..." rows="3" class="w-full border-gray-300 border-2 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"></textarea>
            </div>
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Su foto</label>
              <input type="file" id="photo-upload" name="photo" accept="image/*" required class="hidden">
              <label for="photo-upload" class="cursor-pointer group flex items-center justify-center w-full border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-indigo-500 transition">
                <div class="text-gray-500 group-hover:text-indigo-600">
                  <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                  <p id="file-name-label" class="mt-2 text-sm">Sube su mejor foto</p>
                </div>
              </label>
            </div>
            <button type="submit" id="submitBtn" class="w-full bg-amber-500 text-indigo-900 font-bold py-4 text-lg rounded-lg hover:bg-amber-600 transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-amber-300">
              Ver Preview Gratis
            </button>
          </form>
        </div>

        <div class="lg:sticky lg:top-10">
          <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-4 rounded-xl shadow-2xl transform -rotate-1">
            <div class="bg-white rounded-lg p-4">
              <div id="cover-image-placeholder" class="w-full h-72 sm:h-80 md:h-96 bg-gray-100 rounded-md flex items-center justify-center mb-4 overflow-hidden border">
                <img id="cover-image" src="" alt="Previsualización de la portada" class="hidden w-full h-full object-cover">
                <svg id="cover-icon" class="h-16 w-16 text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
              </div>
              <h3 class="text-xl sm:text-2xl font-bold text-center text-gray-800">Crear cuento para</h3>
              <h3 id="cover-name" class="text-xl sm:text-2xl font-bold text-center text-indigo-600 mb-4 transition-colors">...</h3>
              <div class="text-center text-gray-500 text-sm p-2 bg-gray-50 rounded-md">
                <p id="story-details-preview">Personalizando historia...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Modal -->
  <div id="loading" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-3xl shadow-2xl p-12 max-w-md mx-4 text-center">
      <div class="flex justify-center mb-6">
        <div class="animate-spin rounded-full h-24 w-24 border-b-4 border-indigo-600"></div>
      </div>
      <h2 class="text-3xl font-bold text-gray-800 mb-3">Creando magia...</h2>
      <p class="text-gray-600 text-lg">Esto puede tardar 1-2 minutos</p>
    </div>
  </div>

<script>
  const nameInput = document.getElementById('child_name_input');
  const ageInput = document.getElementById('child_age_input');
  const descInput = document.getElementById('child_desc_input');
  const fileInput = document.getElementById('photo-upload');
  const coverName = document.getElementById('cover-name');
  const storyDetails = document.getElementById('story-details-preview');
  const coverImage = document.getElementById('cover-image');
  const coverIcon = document.getElementById('cover-icon');
  const fileNameLabel = document.getElementById('file-name-label');

  function updateStoryDetails() {
    const age = ageInput.value;
    const desc = descInput.value;
    if (age || desc) {
      storyDetails.textContent = `Para un peque de ${age || '?'} años. ¡Anotado!`;
    } else {
      storyDetails.textContent = 'Personalizando historia...';
    }
  }

  nameInput.addEventListener('input', () => {
    const name = nameInput.value.trim();
    coverName.textContent = name ? name.charAt(0).toUpperCase() + name.slice(1) : '...';
  });

  ageInput.addEventListener('input', updateStoryDetails);
  descInput.addEventListener('input', updateStoryDetails);

  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        coverImage.src = e.target.result;
        coverImage.classList.remove('hidden');
        coverIcon.classList.add('hidden');
      };
      reader.readAsDataURL(file);
      fileNameLabel.textContent = file.name;
    }
  });

  // Form submission
  document.getElementById('bookForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const loadingDiv = document.getElementById('loading');
    const submitBtn = document.getElementById('submitBtn');
    
    // Show loading
    submitBtn.disabled = true;
    submitBtn.textContent = 'Creando...';
    loadingDiv.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    
    try {
      const response = await fetch('/api/books/create-preview', {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (response.ok) {
        window.location.href = '/preview/' + data.id;
      } else {
        alert('❌ Error: ' + data.detail);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Ver Preview Gratis';
        loadingDiv.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    } catch (err) {
      alert('❌ Error de conexión: ' + err.message);
      submitBtn.disabled = false;
      submitBtn.textContent = 'Ver Preview Gratis';
      loadingDiv.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  });
</script>

</body>
{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>

<!-- Hero Section -->
<div class="bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 text-white py-20">
    <div class="container mx-auto px-4 max-w-6xl">
        <div class="text-center mb-12">
            <h1 class="text-6xl md:text-7xl font-black mb-6 drop-shadow-lg">
                El Libro Donde<br>Tu Hijo es el Héroe
            </h1>
            <p class="text-2xl md:text-3xl font-light mb-8 drop-shadow">
                Historia personalizada + 12 ilustraciones únicas generadas con IA
            </p>
            <div class="flex items-center justify-center gap-4 text-lg">
                <span class="bg-white/20 backdrop-blur px-4 py-2 rounded-full">✨ Listo en 10 minutos</span>
                <span class="bg-white/20 backdrop-blur px-4 py-2 rounded-full">📱 PDF para imprimir</span>
                <span class="bg-white/20 backdrop-blur px-4 py-2 rounded-full">💯 100% Único</span>
            </div>
        </div>
    </div>
</div>

<!-- Preview Examples Section -->
<div class="bg-white py-16">
    <div class="container mx-auto px-4 max-w-6xl">
        <h2 class="text-4xl font-bold text-center mb-12 text-gray-800">
            Mira lo que otros padres han creado
        </h2>
        
        <div class="grid md:grid-cols-3 gap-8 mb-12">
            <!-- Example Book 1 -->
            <div class="bg-gradient-to-br from-blue-100 to-blue-50 rounded-2xl p-6 shadow-lg hover:shadow-xl transition transform hover:-translate-y-2">
                <div class="bg-blue-200 rounded-xl h-64 mb-4 flex items-center justify-center text-6xl">
                    📚
                </div>
                <h3 class="font-bold text-xl mb-2">Las Aventuras de Lucas en el Espacio</h3>
                <p class="text-gray-600 text-sm mb-4">Lucas, 5 años • Tema: Espacio</p>
                <div class="flex items-center gap-2 text-yellow-500">
                    ⭐⭐⭐⭐⭐ <span class="text-gray-600 text-sm">Le encantó</span>
                </div>
            </div>

            <!-- Example Book 2 -->
            <div class="bg-gradient-to-br from-pink-100 to-pink-50 rounded-2xl p-6 shadow-lg hover:shadow-xl transition transform hover:-translate-y-2">
                <div class="bg-pink-200 rounded-xl h-64 mb-4 flex items-center justify-center text-6xl">
                    🦄
                </div>
                <h3 class="font-bold text-xl mb-2">María y el Unicornio Mágico</h3>
                <p class="text-gray-600 text-sm mb-4">María, 7 años • Tema: Fantasía</p>
                <div class="flex items-center gap-2 text-yellow-500">
                    ⭐⭐⭐⭐⭐ <span class="text-gray-600 text-sm">No para de leerlo</span>
                </div>
            </div>

            <!-- Example Book 3 -->
            <div class="bg-gradient-to-br from-green-100 to-green-50 rounded-2xl p-6 shadow-lg hover:shadow-xl transition transform hover:-translate-y-2">
                <div class="bg-green-200 rounded-xl h-64 mb-4 flex items-center justify-center text-6xl">
                    🦖
                </div>
                <h3 class="font-bold text-xl mb-2">Diego y los Dinosaurios Perdidos</h3>
                <p class="text-gray-600 text-sm mb-4">Diego, 4 años • Tema: Dinosaurios</p>
                <div class="flex items-center gap-2 text-yellow-500">
                    ⭐⭐⭐⭐⭐ <span class="text-gray-600 text-sm">Su favorito</span>
                </div>
            </div>
        </div>

        <div class="text-center">
            <p class="text-gray-600 text-lg mb-4">
                Más de <span class="font-bold text-purple-600">{{ stats.total_books }}</span> libros únicos ya creados
            </p>
        </div>
    </div>
</div>

<!-- CTA Section -->
<div class="bg-gradient-to-br from-purple-50 to-pink-50 py-16">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12">
            <div class="text-center mb-8">
                <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                    Crea tu libro ahora
                </h2>
                <p class="text-xl text-gray-600">
                    Empieza gratis con un preview • Solo pagas si te encanta
                </p>
            </div>

            <form id="bookForm" method="post" action="/api/books/create-preview" enctype="multipart/form-data" class="space-y-6">
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Child Name -->
                    <div>
                        <label class="block text-gray-800 font-bold mb-3 text-lg">
                            👤 ¿Cómo se llama?
                        </label>
                        <input 
                            type="text" 
                            name="child_name" 
                            placeholder="Ej: María" 
                            required
                            class="w-full px-5 py-4 text-lg border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition"
                        >
                    </div>

                    <!-- Child Age -->
                    <div>
                        <label class="block text-gray-800 font-bold mb-3 text-lg">
                            🎂 ¿Qué edad tiene?
                        </label>
                        <input 
                            type="number" 
                            name="child_age" 
                            min="1" 
                            max="99" 
                            placeholder="Ej: 5" 
                            required
                            class="w-full px-5 py-4 text-lg border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition"
                        >
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-gray-800 font-bold mb-3 text-lg">
                        ✨ ¿Qué le apasiona? (opcional pero recomendado)
                    </label>
                    <textarea 
                        name="child_description" 
                        placeholder="Ej: Le encantan los dinosaurios, juega al fútbol, sueña con ser astronauta..."
                        rows="3"
                        class="w-full px-5 py-4 text-lg border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition resize-none"
                    ></textarea>
                    <p class="text-sm text-gray-500 mt-2">💡 Cuanto más nos cuentes, más personalizada será la historia</p>
                </div>

                <!-- Photo Upload -->
                <div>
                    <label class="block text-gray-800 font-bold mb-3 text-lg">
                        📸 Sube una foto
                    </label>
                    <input 
                        type="file" 
                        name="photo" 
                        accept="image/*" 
                        required
                        id="photoInput"
                        class="hidden"
                    >
                    <label 
                        for="photoInput"
                        id="photoLabel"
                        class="flex flex-col items-center justify-center w-full px-6 py-12 border-3 border-dashed border-purple-300 rounded-xl cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition bg-gradient-to-br from-purple-50 to-pink-50"
                    >
                        <div class="text-center" id="uploadPrompt">
                            <div class="text-6xl mb-4">📷</div>
                            <p class="text-xl font-semibold text-gray-700 mb-2">
                                Click aquí para subir la foto
                            </p>
                            <p class="text-gray-500">
                                La IA creará al personaje basándose en la foto
                            </p>
                        </div>
                    </label>
                    <div id="photoPreview" class="hidden mt-6">
                        <div class="relative inline-block">
                            <img id="photoPreviewImg" class="max-w-sm rounded-2xl shadow-2xl mx-auto">
                            <button type="button" onclick="clearPhoto()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600">
                                ✕
                            </button>
                        </div>
                        <p class="text-center text-gray-600 mt-3 font-semibold" id="photoFileName"></p>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-6">
                    <div class="flex items-start gap-4">
                        <div class="text-4xl">🎁</div>
                        <div>
                            <h4 class="font-bold text-lg mb-2">Qué incluye tu libro:</h4>
                            <ul class="space-y-1 text-gray-700">
                                <li>✅ Historia única generada con IA</li>
                                <li>✅ 12 páginas con ilustraciones personalizadas</li>
                                <li>✅ Tu hijo como protagonista</li>
                                <li>✅ PDF listo para imprimir en alta calidad</li>
                                <li>✅ Entrega en menos de 10 minutos</li>
                            </ul>
                            <p class="mt-4 text-2xl font-bold text-purple-600">
                                Solo {{ base_price }}€
                            </p>
                            <p class="text-sm text-gray-600">Preview gratis • Pagas solo si te gusta</p>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-gradient-to-r from-purple-600 via-pink-500 to-orange-500 text-white font-black text-2xl py-6 px-8 rounded-xl hover:from-purple-700 hover:via-pink-600 hover:to-orange-600 transition shadow-xl transform hover:scale-105 duration-200"
                >
                    🚀 CREAR MI PREVIEW GRATIS
                </button>

                <p class="text-center text-gray-500 text-sm">
                    Sin compromiso • Verás un preview antes de pagar
                </p>

            </form>
        </div>
    </div>
</div>

<!-- Loading State -->
<div id="loading" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-3xl shadow-2xl p-12 max-w-md mx-4 text-center">
        <div class="flex justify-center mb-6">
            <div class="animate-spin rounded-full h-24 w-24 border-b-4 border-purple-600"></div>
        </div>
        <h2 class="text-3xl font-bold text-gray-800 mb-3">Creando magia...</h2>
        <p class="text-gray-600 text-lg">Esto puede tardar 1-2 minutos</p>
        <div class="mt-6 text-sm text-gray-500">
            Generando tu historia personalizada ✨
        </div>
    </div>
</div>

<!-- Trust Section -->
<div class="bg-white py-16">
    <div class="container mx-auto px-4 max-w-6xl text-center">
        <h3 class="text-3xl font-bold mb-8 text-gray-800">Por qué los padres nos eligen</h3>
        <div class="grid md:grid-cols-4 gap-8">
            <div>
                <div class="text-5xl mb-4">⚡</div>
                <h4 class="font-bold mb-2">Súper rápido</h4>
                <p class="text-gray-600">Tu libro listo en menos de 10 minutos</p>
            </div>
            <div>
                <div class="text-5xl mb-4">🎨</div>
                <h4 class="font-bold mb-2">100% Único</h4>
                <p class="text-gray-600">Cada libro es irrepetible, creado con IA</p>
            </div>
            <div>
                <div class="text-5xl mb-4">❤️</div>
                <h4 class="font-bold mb-2">Hecho con amor</h4>
                <p class="text-gray-600">Personalizado según los gustos de tu hijo</p>
            </div>
            <div>
                <div class="text-5xl mb-4">✨</div>
                <h4 class="font-bold mb-2">Regalo perfecto</h4>
                <p class="text-gray-600">El regalo que nunca olvidarán</p>
            </div>
        </div>
    </div>
</div>

<script>
    function clearPhoto() {
        document.getElementById('photoInput').value = '';
        document.getElementById('photoPreview').classList.add('hidden');
        document.getElementById('uploadPrompt').classList.remove('hidden');
    }

    // Photo preview
    document.getElementById('photoInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photoPreviewImg').src = e.target.result;
                document.getElementById('photoFileName').textContent = file.name;
                document.getElementById('photoPreview').classList.remove('hidden');
                document.getElementById('uploadPrompt').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }
    });

    // Form submission
    document.getElementById('bookForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const loadingDiv = document.getElementById('loading');
        
        // Show loading
        loadingDiv.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        
        try {
            const response = await fetch('/api/books/create-preview', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok) {
                window.location.href = '/preview/' + data.id;
            } else {
                alert('❌ Error: ' + data.detail);
                loadingDiv.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        } catch (err) {
            alert('❌ Error de conexión: ' + err.message);
            loadingDiv.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    });
</script>
{% endblock %}
    <div class="container mx-auto px-4 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-4">
                ✨ Crea tu Libro Mágico ✨
            </h1>
            <p class="text-gray-600 text-lg">Genera un libro personalizado con IA en minutos</p>
        </div>

        <!-- Stats Card -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="p-4">
                    <div class="text-3xl font-bold text-blue-600">{{ stats.total_books }}</div>
                    <div class="text-gray-600 text-sm">Libros Creados</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-purple-600">{{ base_price }}€</div>
                    <div class="text-gray-600 text-sm">Precio Base</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-pink-600">12</div>
                    <div class="text-gray-600 text-sm">Páginas Ilustradas</div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">📝 Información del Libro</h2>
            
            <form id="bookForm" method="post" action="/api/books/create-preview" enctype="multipart/form-data" class="space-y-6">
                
                <!-- Child Name -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Nombre del niño/a
                    </label>
                    <input 
                        type="text" 
                        name="child_name" 
                        placeholder="Ej: María" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    >
                </div>

                <!-- Child Age -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Edad (1-12 años)
                    </label>
                    <input 
                        type="number" 
                        name="child_age" 
                        min="1" 
                        max="12" 
                        placeholder="5" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    >
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Descripción e intereses (opcional)
                    </label>
                    <textarea 
                        name="child_description" 
                        placeholder="Le gustan los dinosaurios, el espacio, las princesas..."
                        rows="3"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition resize-none"
                    ></textarea>
                </div>

                <!-- Photo Upload -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        📸 Foto del niño/a
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            name="photo" 
                            accept="image/*" 
                            required
                            id="photoInput"
                            class="hidden"
                        >
                        <label 
                            for="photoInput"
                            class="flex items-center justify-center w-full px-4 py-6 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition bg-gray-50"
                        >
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <p class="mt-2 text-sm text-gray-600">
                                    <span class="font-semibold text-blue-600">Click para subir foto</span>
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF hasta 16MB</p>
                            </div>
                        </label>
                    </div>
                    <div id="photoPreview" class="mt-4 hidden">
                        <img id="photoPreviewImg" class="max-w-xs rounded-lg shadow-lg mx-auto">
                        <p class="text-center text-sm text-gray-600 mt-2" id="photoFileName"></p>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition shadow-lg transform hover:scale-105 duration-200"
                >
                    🎨 Crear Preview Gratuito
                </button>

                <p class="text-sm text-gray-500 text-center">
                    El preview incluye la portada y detalles del libro. ¡Totalmente gratis!
                </p>

            </form>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden bg-white rounded-2xl shadow-xl p-12 text-center">
            <div class="flex justify-center mb-6">
                <div class="animate-spin rounded-full h-20 w-20 border-b-4 border-blue-600"></div>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Creando tu preview mágico...</h2>
            <p class="text-gray-600">Esto puede tardar 1-2 minutos</p>
        </div>

        <!-- Footer Info -->
        <div class="text-center text-gray-500 text-sm mt-8">
            <p>✨ Powered by Gemini AI • 🎨 Ilustraciones únicas generadas con IA</p>
        </div>

    </div>
</div>

<script>
    // Photo preview
    document.getElementById('photoInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photoPreviewImg').src = e.target.result;
                document.getElementById('photoFileName').textContent = file.name;
                document.getElementById('photoPreview').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    });

    // Form submission
    document.getElementById('bookForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const submitBtn = document.getElementById('submitBtn');
        const loadingDiv = document.getElementById('loading');
        const formCard = this.closest('.bg-white');
        
        // Show loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = '⏳ Creando...';
        loadingDiv.classList.remove('hidden');
        formCard.classList.add('hidden');
        
        try {
            const response = await fetch('/api/books/create-preview', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok) {
                // Redirect to preview
                window.location.href = '/preview/' + data.id;
            } else {
                alert('❌ Error: ' + data.detail);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '🎨 Crear Preview Gratuito';
                loadingDiv.classList.add('hidden');
                formCard.classList.remove('hidden');
            }
        } catch (err) {
            alert('❌ Error de conexión: ' + err.message);
            submitBtn.disabled = false;
            submitBtn.innerHTML = '🎨 Crear Preview Gratuito';
            loadingDiv.classList.add('hidden');
            formCard.classList.remove('hidden');
            console.error(err);
        }
    });
</script>
{% endblock %}
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-4">
                ✨ Crea tu Libro Mágico ✨
            </h1>
            <p class="text-gray-600 text-lg">Genera un libro personalizado con IA en minutos</p>
        </div>

        <!-- Stats Card -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="p-4">
                    <div class="text-3xl font-bold text-blue-600">{{ stats.total_books }}</div>
                    <div class="text-gray-600 text-sm">Libros Creados</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-purple-600">{{ base_price }}€</div>
                    <div class="text-gray-600 text-sm">Precio Base</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-pink-600">12</div>
                    <div class="text-gray-600 text-sm">Páginas Ilustradas</div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">📝 Información del Libro</h2>
            
            <form id="bookForm" method="post" action="/api/books/create-preview" enctype="multipart/form-data" class="space-y-6">
                
                <!-- Child Name -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Nombre del niño/a
                    </label>
                    <input 
                        type="text" 
                        name="child_name" 
                        placeholder="Ej: María" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    >
                </div>

                <!-- Child Age -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Edad (1-12 años)
                    </label>
                    <input 
                        type="number" 
                        name="child_age" 
                        min="1" 
                        max="12" 
                        placeholder="5" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
                    >
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        Descripción e intereses (opcional)
                    </label>
                    <textarea 
                        name="child_description" 
                        placeholder="Le gustan los dinosaurios, el espacio, las princesas..."
                        rows="3"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition resize-none"
                    ></textarea>
                </div>

                <!-- Photo Upload -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">
                        📸 Foto del niño/a
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            name="photo" 
                            accept="image/*" 
                            required
                            id="photoInput"
                            class="hidden"
                        >
                        <label 
                            for="photoInput"
                            class="flex items-center justify-center w-full px-4 py-6 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition bg-gray-50"
                        >
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <p class="mt-2 text-sm text-gray-600">
                                    <span class="font-semibold text-blue-600">Click para subir foto</span>
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF hasta 16MB</p>
                            </div>
                        </label>
                    </div>
                    <div id="photoPreview" class="mt-4 hidden">
                        <img id="photoPreviewImg" class="max-w-xs rounded-lg shadow-lg mx-auto">
                        <p class="text-center text-sm text-gray-600 mt-2" id="photoFileName"></p>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition shadow-lg transform hover:scale-105 duration-200"
                >
                    🎨 Crear Preview Gratuito
                </button>

                <p class="text-sm text-gray-500 text-center">
                    El preview incluye la portada y detalles del libro. ¡Totalmente gratis!
                </p>

            </form>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden bg-white rounded-2xl shadow-xl p-12 text-center">
            <div class="flex justify-center mb-6">
                <div class="animate-spin rounded-full h-20 w-20 border-b-4 border-blue-600"></div>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Creando tu preview mágico...</h2>
            <p class="text-gray-600">Esto puede tardar 1-2 minutos</p>
        </div>

        <!-- Footer Info -->
        <div class="text-center text-gray-500 text-sm mt-8">
            <p>✨ Powered by Gemini AI • 🎨 Ilustraciones únicas generadas con IA</p>
        </div>

    </div>

    <script>
        // Photo preview
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreviewImg').src = e.target.result;
                    document.getElementById('photoFileName').textContent = file.name;
                    document.getElementById('photoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Form submission
        document.getElementById('bookForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = document.getElementById('submitBtn');
            const loadingDiv = document.getElementById('loading');
            const formCard = this.closest('.bg-white');
            
            // Show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '⏳ Creando...';
            loadingDiv.classList.remove('hidden');
            formCard.classList.add('hidden');
            
            try {
                const response = await fetch('/api/books/create-preview', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Redirect to preview
                    window.location.href = '/preview/' + data.id;
                } else {
                    alert('❌ Error: ' + data.detail);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '🎨 Crear Preview Gratuito';
                    loadingDiv.classList.add('hidden');
                    formCard.classList.remove('hidden');
                }
            } catch (err) {
                alert('❌ Error de conexión: ' + err.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '🎨 Crear Preview Gratuito';
                loadingDiv.classList.add('hidden');
                formCard.classList.remove('hidden');
                console.error(err);
            }
        });
    </script>
</body>
</html>